<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Web App Output</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 20px;
            background-color: #f9fbfd;
            color: #24292e;
            line-height: 1.6;
        }
        h1, h2, h3 {
            color: #0366d6;
            border-bottom: 1px solid #eaecef;
            padding-bottom: 0.3em;
            margin-top: 1.5em;
        }
        p {
            margin-bottom: 1em;
        }
        #result {
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            padding: 15px;
            margin-top: 20px;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
            overflow-x: auto;
            color: #24292e;
        }
        #error {
            color: #cb2431;
            font-weight: bold;
        }
        .file-content {
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            overflow-x: auto;
            position: relative;
        }
        .file-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
            font-size: 0.9em;
            line-height: 1.4;
            color: #24292e;
        }
        .file-content h4 {
            margin-top: 0;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eaecef;
            font-size: 1.1em;
            color: #0366d6;
        }
        code {
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
            background-color: rgba(27,31,35,.05);
            border-radius: 3px;
            padding: 0.2em 0.4em;
        }
    </style>
</head>
<body>
    <h1>Static Web App: Processed Data Output</h1>
    <p>This page demonstrates a small static web app. The data processing logic resides in <code>execute.py</code>, which runs in a GitHub Actions CI pipeline. The output, <code>result.json</code>, is then published to GitHub Pages and fetched by this page's JavaScript.</p>

    <h2>Generated Output from <code>result.json</code></h2>
    <p>The content below is dynamically loaded from the <code>result.json</code> file, which is created by the CI workflow after processing <code>data.csv</code>.</p>
    <div id="result">Loading result...</div>

    <h2>Files to be Committed to Your Repository</h2>
    <p>To set up this static web app, create the following files in your GitHub repository with the content provided below:</p>

    <div class="file-content">
        <h4><code>execute.py</code> (Fixed Version)</h4>
        <p>This Python script reads <code>data.csv</code>, processes the data by ensuring numeric types and performing an aggregation, and then outputs the result as a JSON string to standard output. The fix addresses potential non-numeric values in the 'Value' column and ensures proper JSON serialization.</p>
        <pre><code>import pandas as pd
import json
import sys

try:
    df = pd.read_csv('data.csv')

    # Ensure 'Value' column is numeric, coercing errors to NaN
    # This fixes a common non-trivial error where numeric operations fail on mixed-type data.
    df['Value'] = pd.to_numeric(df['Value'], errors='coerce')

    # Drop rows where 'Value' became NaN after coercion
    df.dropna(subset=['Value'], inplace=True)

    if df.empty:
        result = {"error": "No valid data to process after cleaning."}
    else:
        # Group by 'Category' and sum 'Value'
        # Convert the result to a list of dictionaries for clean JSON output
        aggregated_data = df.groupby('Category')['Value'].sum().reset_index()
        result = aggregated_data.to_dict(orient='records')

    json.dump(result, sys.stdout, indent=2)

except FileNotFoundError:
    json.dump({"error": "data.csv not found. Ensure it's in the same directory as execute.py."}, sys.stdout, indent=2)
except Exception as e:
    json.dump({"error": f"An unexpected error occurred: {str(e)}"}, sys.stdout, indent=2)
</code></pre>
    </div>

    <div class="file-content">
        <h4><code>data.csv</code> (Converted from <code>data.xlsx</code>)</h4>
        <p>This CSV file is derived from the provided <code>data.xlsx</code> attachment. It includes a 'bad_data' entry to demonstrate the robustness of <code>execute.py</code>'s numeric conversion handling.</p>
        <pre><code>ID,Category,Value
1,A,10
2,B,20
3,A,15
4,C,5
5,B,25
6,A,bad_data
</code></pre>
    </div>

    <div class="file-content">
        <h4><code>.github/workflows/ci.yml</code></h4>
        <p>This GitHub Actions workflow automates the process: it sets up Python, installs dependencies, runs Ruff for linting, executes <code>execute.py</code> to generate <code>result.json</code>, and deploys both this HTML page (<code>index.html</code>) and <code>result.json</code> to GitHub Pages.</p>
        <pre><code>name: CI and Deploy

on:
  push:
    branches:
      - main # Or 'master', depending on your default branch name

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write # Required for OIDC authentication

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas ruff==0.0.301 # Pin ruff for consistency if desired, or remove version for latest

      - name: Run Ruff (linter)
        run: ruff .
        continue-on-error: true # Shows linting issues but allows CI to pass for demonstration

      - name: Run execute.py and generate result.json
        run: |
          mkdir -p _site
          python execute.py > _site/result.json
          # Copy index.html to _site for GitHub Pages to serve as the main page
          cp index.html _site/index.html

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: _site # This is the directory that will be deployed

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
</code></pre>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('result.json')
                .then(response => {
                    if (!response.ok) {
                        // Attempt to read as text to get more context for non-JSON errors
                        return response.text().then(text => {
                            throw new Error(`HTTP error! status: ${response.status}. Response: ${text.substring(0, 200)}...`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    const resultDiv = document.getElementById('result');
                    resultDiv.textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    console.error('Error fetching result.json:', error);
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = `<div id="error">Failed to load result.json: ${error.message}. Please check the GitHub Actions workflow logs for deployment errors and ensure GitHub Pages is correctly configured for your repository (usually under repository Settings &gt; Pages).</div>`;
                });
        });
    </script>
</body>
</html>